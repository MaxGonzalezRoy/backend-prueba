<script>
    async function ensureCart() {
        let cartId = localStorage.getItem('cartId');
        if (!cartId) {
            const res = await fetch('/api/carts', { method: 'POST' });
            const data = await res.json();
            cartId = data.cart._id;
            localStorage.setItem('cartId', cartId);
        }
        return cartId;
    }

    async function addToCart(productId) {
        const cartId = await ensureCart();

        const res = await fetch(`/api/carts/${cartId}/product/${productId}`, {
            method: 'POST'
        });

        if (res.ok) {
            Swal.fire({
                title: 'Agregado',
                text: 'Producto agregado al carrito.',
                icon: 'success',
                timer: 1500,
                showConfirmButton: false
            });
        } else {
            Swal.fire('Error', 'No se pudo agregar el producto.', 'error');
        }
    }
</script>